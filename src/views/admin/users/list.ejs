<!-- views/admin/users/list.ejs -->
<div class="mx-auto max-w-6xl p-4 sm:p-6">
  <!-- Header -->
  <div class="flex items-start justify-between gap-3">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Users</h1>
      <p class="mt-1 text-sm text-gray-600">Manage roles and view account details</p>
    </div>
    <a href="/admin"
       class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-2 text-sm font-medium text-gray-800 ring-1 ring-gray-200 hover:bg-gray-200">
      ‚Üê Admin Home
    </a>
  </div>

  <!-- Search -->
  <form method="GET" action="/admin/users" class="mt-5">
    <div class="flex w-full items-center gap-2">
      <label class="relative block w-full">
        <input
          type="text"
          name="q"
          value="<%= q || '' %>"
          placeholder="Search email or name"
          class="w-full rounded-xl border border-gray-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-200"
        />
        <span class="pointer-events-none absolute right-3 top-2.5 text-gray-400">
          <svg viewBox="0 0 24 24" class="h-4 w-4"><path fill="currentColor" d="M15.5 14h-.8l-.3-.3a6.5 6.5 0 10-.7.7l.3.3v.8l5 5 1.5-1.5-5-5zM10 15a5 5 0 110-10 5 5 0 010 10z"/></svg>
        </span>
      </label>
      <button
        type="submit"
        class="inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-blue-500"
      >
        Search
      </button>
    </div>
  </form>

  <!-- Table -->
  <div class="mt-5 overflow-hidden rounded-2xl ring-1 ring-gray-100 bg-white">
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50 text-gray-600">
          <tr>
            <th class="px-4 py-3 text-left font-medium">Email</th>
            <th class="px-4 py-3 text-left font-medium">Name</th>
            <th class="px-4 py-3 text-left font-medium">Role</th>
            <th class="px-4 py-3 text-left font-medium">Created</th>
            <th class="px-4 py-3 text-right font-medium">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <% users.forEach(u => { %>
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-3 text-gray-800 break-all"><%= u.email %></td>
              <td class="px-4 py-3 text-gray-700"><%= u.name || "" %></td>
              <td class="px-4 py-3">
                <% if (u.role === "ADMIN") { %>
                  <span class="inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-700 ring-1 ring-amber-100">Admin</span>
                <% } else { %>
                  <span class="inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-700 ring-1 ring-gray-200"><%= u.role %></span>
                <% } %>
              </td>
              <td class="px-4 py-3 text-gray-600">
                <%= new Date(u.createdAt).toLocaleString('en-GB', { day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit', hour12:true }) %>
              </td>
              <td class="px-4 py-3">
                <div class="flex items-center justify-end gap-2">
                  <a href="/admin/users/<%= u.id %>/edit"
                     class="inline-flex items-center rounded-full px-3 py-1.5 text-xs font-medium text-gray-800 ring-1 ring-gray-200 hover:bg-gray-50">
                    Edit
                  </a>

                  <% if (u.role === "ADMIN") { %>
                    <form method="POST" action="/admin/users/<%= u.id %>/demote" class="inline-flex">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <button
                        type="submit"
                        class="inline-flex items-center rounded-full px-3 py-1.5 text-xs font-medium text-rose-700 ring-1 ring-rose-200 hover:bg-rose-50"
                        onclick="return confirm('Demote this admin to user?')"
                      >
                        Demote
                      </button>
                    </form>
                  <% } else { %>
                    <form method="POST" action="/admin/users/<%= u.id %>/promote" class="inline-flex">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <button
                        type="submit"
                        class="inline-flex items-center rounded-full px-3 py-1.5 text-xs font-medium text-emerald-700 ring-1 ring-emerald-200 hover:bg-emerald-50"
                        onclick="return confirm('Promote this user to admin?')"
                      >
                        Promote
                      </button>
                    </form>
                  <% } %>
                </div>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
      <div class="text-sm text-gray-600">
        Page <span class="font-medium text-gray-800"><%= page %></span> of
        <span class="font-medium text-gray-800"><%= totalPages %></span>
      </div>
      <div class="flex items-center gap-2">
        <% if (page > 1) { %>
          <a href="/admin/users?page=<%= page - 1 %>&q=<%= encodeURIComponent(q || '') %>"
             class="inline-flex items-center rounded-full px-3 py-1.5 text-sm font-medium text-gray-800 ring-1 ring-gray-200 hover:bg-gray-100">
            Prev
          </a>
        <% } else { %>
          <span class="inline-flex items-center rounded-full px-3 py-1.5 text-sm text-gray-400 ring-1 ring-gray-100 cursor-not-allowed">Prev</span>
        <% } %>

        <% if (page < totalPages) { %>
          <a href="/admin/users?page=<%= page + 1 %>&q=<%= encodeURIComponent(q || '') %>"
             class="inline-flex items-center rounded-full px-3 py-1.5 text-sm font-medium text-gray-800 ring-1 ring-gray-200 hover:bg-gray-100">
            Next
          </a>
        <% } else { %>
          <span class="inline-flex items-center rounded-full px-3 py-1.5 text-sm text-gray-400 ring-1 ring-gray-100 cursor-not-allowed">Next</span>
        <% } %>
      </div>
    </div>
  </div>
</div>
