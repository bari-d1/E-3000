<!-- views/admin/flags/index.ejs -->
<div class="mx-auto max-w-6xl p-4 sm:p-6">
  <div class="flex items-start justify-between gap-3">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Flagged Sessions</h1>
      <p class="mt-1 text-sm text-gray-600">Review and resolve flagged or pending entries</p>
    </div>
    <a href="/admin"
       class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-2 text-sm font-medium text-gray-800 ring-1 ring-gray-200 hover:bg-gray-200">
      ‚Üê Admin Home
    </a>
  </div>

  <!-- Filters -->
  <div class="mt-5 flex flex-wrap items-center gap-2">
    <a href="/admin/flags"
       class="inline-flex items-center rounded-full px-3 py-1.5 text-sm ring-1
       <%= (!status || status === '') ? 'bg-gray-900 text-white ring-gray-900' : 'bg-white text-gray-800 ring-gray-200 hover:bg-gray-50' %>">
      Needs Attention
    </a>
    <!-- <a href="/admin/flags?status=FLAGGED"
       class="inline-flex items-center rounded-full px-3 py-1.5 text-sm ring-1
       <%= status === 'FLAGGED' ? 'bg-rose-600 text-white ring-rose-600' : 'bg-white text-gray-800 ring-gray-200 hover:bg-gray-50' %>">
      Flagged
    </a> -->
    <!-- <a href="/admin/flags?status=PENDING"
       class="inline-flex items-center rounded-full px-3 py-1.5 text-sm ring-1
       <%= status === 'PENDING' ? 'bg-amber-600 text-white ring-amber-600' : 'bg-white text-gray-800 ring-gray-200 hover:bg-gray-50' %>">
      Pending
    </a>
    <a href="/admin/flags?status=APPROVED"
       class="inline-flex items-center rounded-full px-3 py-1.5 text-sm ring-1
       <%= status === 'APPROVED' ? 'bg-emerald-600 text-white ring-emerald-600' : 'bg-white text-gray-800 ring-gray-200 hover:bg-gray-50' %>">
      Approved
    </a> -->
  </div>

  <!-- Empty state -->
  <% if (!sessions || sessions.length === 0) { %>
    <div class="mt-6 rounded-2xl border border-dashed border-gray-200 bg-white p-8 text-center">
      <div class="mx-auto inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-gray-100 ring-1 ring-gray-200">
        <svg viewBox="0 0 24 24" class="h-6 w-6 text-gray-400"><path fill="currentColor" d="M12 3l9 18H3L12 3zm0 12.5v-5M12 19h.01"/></svg>
      </div>
      <h2 class="mt-3 text-base font-semibold text-gray-800">No items for this filter</h2>
      <p class="mt-1 text-sm text-gray-500">Try a different tab</p>
    </div>
  <% } else { %>

    <!-- Table -->
    <div class="mt-5 overflow-hidden rounded-2xl ring-1 ring-gray-100 bg-white">
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50 text-gray-600">
            <tr>
              <th class="px-4 py-3 text-left font-medium">ID</th>
              <th class="px-4 py-3 text-left font-medium">User</th>
              <th class="px-4 py-3 text-left font-medium">Reason</th>
              <th class="px-4 py-3 text-left font-medium">Date</th>
              <th class="px-4 py-3 text-left font-medium">Status</th>
              <th class="px-4 py-3 text-right font-medium">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <% sessions.forEach(function(s){ %>
              <tr class="hover:bg-gray-50 align-top">
                <td class="px-4 py-3 font-medium text-gray-800"><%= s.id %></td>
                <td class="px-4 py-3 text-gray-800">
                  <div class="font-medium"><%= (s.user && (s.user.name || s.user.email)) || 'Unknown' %></div>
                  <% if (s.user && s.user.email) { %>
                    <div class="text-xs text-gray-500"><%= s.user.email %></div>
                  <% } %>
                </td>
                <td class="px-4 py-3 text-gray-700">
                  <% if (s.flagReason) { %>
                    <div class="max-w-[48ch]"><%= s.flagReason %></div>
                  <% } else { %>
                    <span class="text-gray-400">No reason recorded</span>
                  <% } %>
                </td>
                <td class="px-4 py-3 text-gray-700">
                  <%= new Date(s.createdAt).toLocaleString('en-GB', { day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit', hour12:true }) %>
                </td>
                <td class="px-4 py-3">
                  <% if (s.flagged) { %>
                    <span class="inline-flex items-center rounded-full bg-rose-50 px-2 py-0.5 text-xs font-medium text-rose-700 ring-1 ring-rose-100">Flagged</span>
                  <% } %>
                  <% if (s.status === 'PENDING') { %>
                    <span class="ml-1 inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-700 ring-1 ring-amber-100">Pending</span>
                  <% } %>
                  <% if (!s.flagged && s.status === 'APPROVED') { %>
                    <span class="inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-xs font-medium text-emerald-700 ring-1 ring-emerald-100">Approved</span>
                  <% } %>
                  <% if (!s.flagged && s.status === 'DECLINED') { %>
                    <span class="inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-700 ring-1 ring-gray-200">Declined</span>
                  <% } %>
                </td>
                <td class="px-4 py-3">
                  <div class="flex items-center justify-end gap-2">
                    <form action="/admin/flags/<%= s.id %>/approve" method="POST" class="inline-flex">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <button type="submit"
                              class="inline-flex items-center rounded-full px-3 py-1.5 text-xs font-medium text-emerald-700 ring-1 ring-emerald-200 hover:bg-emerald-50">
                        Approve
                      </button>
                    </form>
                    <form action="/admin/flags/<%= s.id %>/decline" method="POST" class="inline-flex">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <button type="submit"
                              class="inline-flex items-center rounded-full px-3 py-1.5 text-xs font-medium text-rose-700 ring-1 ring-rose-200 hover:bg-rose-50">
                        Decline
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="flex items-center justify-between px-4 py-3 bg-gray-50">
        <div class="text-sm text-gray-600">
          Page <span class="font-medium text-gray-800"><%= page %></span> of
          <span class="font-medium text-gray-800"><%= totalPages %></span>
        </div>
        <div class="flex items-center gap-2">
          <% if (page > 1) { %>
            <a href="/admin/flags?page=<%= page - 1 %><%= status ? '&status=' + encodeURIComponent(status) : '' %>"
               class="inline-flex items-center rounded-full px-3 py-1.5 text-sm font-medium text-gray-800 ring-1 ring-gray-200 hover:bg-gray-100">
              Prev
            </a>
          <% } else { %>
            <span class="inline-flex items-center rounded-full px-3 py-1.5 text-sm text-gray-400 ring-1 ring-gray-100 cursor-not-allowed">Prev</span>
          <% } %>
          <% if (page < totalPages) { %>
            <a href="/admin/flags?page=<%= page + 1 %><%= status ? '&status=' + encodeURIComponent(status) : '' %>"
               class="inline-flex items-center rounded-full px-3 py-1.5 text-sm font-medium text-gray-800 ring-1 ring-gray-200 hover:bg-gray-100">
              Next
            </a>
          <% } else { %>
            <span class="inline-flex items-center rounded-full px-3 py-1.5 text-sm text-gray-400 ring-1 ring-gray-100 cursor-not-allowed">Next</span>
          <% } %>
        </div>
      </div>
    </div>
  <% } %>
</div>
